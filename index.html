<!DOCTYPE html>
<html>
<head>
    <title>Society Data Entry</title>
</head>
<body>

<h2>House-wise Member Entry</h2>

<label>House / Flat No:</label><br>
<input type="text" id="house" required><br><br>

<form id="memberForm">
    <div id="members">
        <div class="member">
            <label>Name:</label>
            <input type="text" class="name" required>

            <label>Age:</label>
            <input type="number" class="age" required>

            <label>Gender:</label>
            <select class="gender">
                <option>Male</option>
                <option>Female</option>
                <option>Other</option>
            </select>

            <label>Relation:</label>
            <input type="text" class="relation">

            <label>Mobile:</label>
            <input type="text" class="mobile" maxlength="10" required>

            <button type="button" onclick="removeMemberRow(this)">Remove</button>
            <hr>
        </div>
    </div>

    <button type="button" onclick="addMember()">Add Another Member</button><br><br>
    <button type="submit">Save All Members</button>
</form>

<hr>

<h3>Saved Members</h3>

<button onclick="printReport()">Print Report</button><br><br>

<table border="1" cellpadding="5" id="reportTable">
    <thead>
        <tr>
            <th>House</th>
            <th>Name</th>
            <th>Age</th>
            <th>Gender</th>
            <th>Relation</th>
            <th>Mobile</th>
            <th>Delete</th>
        </tr>
    </thead>
    <tbody id="tableBody"></tbody>
</table>

<script>
/* ===== Load saved data ===== */
let data = JSON.parse(localStorage.getItem("societyData")) || [];

/* ===== Add member input row ===== */
function addMember() {
    const div = document.createElement("div");
    div.className = "member";
    div.innerHTML = `
        <label>Name:</label>
        <input type="text" class="name" required>

        <label>Age:</label>
        <input type="number" class="age" required>

        <label>Gender:</label>
        <select class="gender">
            <option>Male</option>
            <option>Female</option>
            <option>Other</option>
        </select>

        <label>Relation:</label>
        <input type="text" class="relation">

        <label>Mobile:</label>
        <input type="text" class="mobile" maxlength="10" required>

        <button type="button" onclick="removeMemberRow(this)">Remove</button>
        <hr>
    `;
    document.getElementById("members").appendChild(div);
}

/* ===== Remove input row before saving ===== */
function removeMemberRow(btn) {
    const rows = document.querySelectorAll(".member");
    if (rows.length > 1) {
        btn.parentElement.remove();
    } else {
        alert("At least one member is required.");
    }
}

/* ===== Save members ===== */
document.getElementById("memberForm").addEventListener("submit", function(e) {
    e.preventDefault();

    const house = document.getElementById("house").value.trim();
    if (!house) {
        alert("Enter house number");
        return;
    }

    document.querySelectorAll(".member").forEach(m => {
        data.push({
            house: house,
            name: m.querySelector(".name").value,
            age: m.querySelector(".age").value,
            gender: m.querySelector(".gender").value,
            relation: m.querySelector(".relation").value,
            mobile: m.querySelector(".mobile").value
        });
    });

    localStorage.setItem("societyData", JSON.stringify(data));
    showData();

    this.reset();
    document.getElementById("members").innerHTML = document.querySelector(".member").outerHTML;
});

/* ===== Show saved data with delete button ===== */
function showData() {
    const table = document.getElementById("tableBody");
    table.innerHTML = "";

    data.forEach((d, index) => {
        table.innerHTML += `
            <tr>
                <td>${d.house}</td>
                <td>${d.name}</td>
                <td>${d.age}</td>
                <td>${d.gender}</td>
                <td>${d.relation}</td>
                <td>${d.mobile}</td>
                <td>
                    <button onclick="deleteStoredMember(${index})">Delete</button>
                </td>
            </tr>
        `;
    });
}

/* ===== Delete from stored data ===== */
function deleteStoredMember(index) {
    if (confirm("Are you sure you want to delete this member?")) {
        data.splice(index, 1);
        localStorage.setItem("societyData", JSON.stringify(data));
        showData();
    }
}

/* ===== Print report ===== */
function printReport() {
    let content = document.getElementById("reportTable").outerHTML;
    let win = window.open("", "", "width=800,height=600");
    win.document.write("<h2>Society Member Report</h2>");
    win.document.write(content);
    win.document.close();
    win.print();
}

/* ===== Mobile validation (10 digits only) ===== */
document.addEventListener("input", function(e) {
    if (e.target.classList.contains("mobile")) {
        e.target.value = e.target.value.replace(/[^0-9]/g, "").slice(0, 10);
    }
});

/* ===== Name validation (letters & spaces only) ===== */
document.addEventListener("input", function(e) {
    if (e.target.classList.contains("name")) {
        e.target.value = e.target.value.replace(/[^a-zA-Z\s]/g, "");
    }
});

/* Initial load */
showData();
</script>

</body>
</html>
